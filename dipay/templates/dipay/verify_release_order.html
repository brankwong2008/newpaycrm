{% extends "layout.html" %}
{% load menu_list %}
{% load static %}
{% block css %}


    <style>
        tr.active {
            border-left: 3px solid orange;
        }

        .relate-btn {

            margin-right: 35px;
        }

        textarea[id^="amount"] {
            width: 87px;
            height: 36px;
        }

        .text-display, .date-display, .status-display, .invoice-amount-display {
            cursor: pointer;

        }

        .fa-check {
            color: green;
            font-size: 20px;
        }

        td.dist-amount {
            font-weight: bolder;
            color: blue;
        }

        .is-agree-div {
            margin: 20px 0px;
        }

        .agree-release {
            color: dodgerblue;
            margin-left: 30px;
        }

        .not-agree {
            color: darkorange;
        }


    </style>

{% endblock %}


{% block content %}

    <div class="container-fluid">

        <div class="col-md-12">
            <!-- 订单记录 -->
            <div class="panel panel-info">
                {% csrf_token %}

                <div class="panel-heading"><i class="fa fa-get-pocket"></i>订单

                </div>

                <!-- Table -->
                <table class="table">
                    <thead>
                    <tr>
                        <th>下单日期</th>
                        <th>订单号</th>
                        <th>客户</th>
                        <th>发票金额</th>
                        <th>已收款总额</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>{{ order_obj.confirm_date|date:"Y-m-d" }}</td>
                        <td>{{ order_obj.order_number }}</td>
                        <td>{{ order_obj.customer.shortname|default:'-' }}</td>
                        <td>{{ order_obj.currency.icon }}{{ order_obj.amount }}</td>
                        <td>{{ order_obj.currency.icon }}{{ order_obj.rcvd_amount }}</td>
                    </tr>
                    </tbody>
                </table>
            </div>


            <!-- 收款明细记录 -->
            <div class="panel panel-success">
                <div class="panel-heading"><i class="fa fa-building"></i> 收款明细记录</div>
                <div class="panel-body">
                    <!-- 待关联订单列表 -->
                    <table class="table">
                        <thead>
                        <tr>
                            <th>到账日期</th>
                            <th>关联金额</th>
                            <th>来源</th>
                        </tr>
                        </thead>
                        <tbody>

                        {% for row in pay2order_list %}
                            <tr>
                                <td>{{ row.payment.create_date|date:"Y-m-d" }}</td>
                                <td>{{ row.payment.currency.icon }}{{ row.amount }}</td>
                                <td>
                                    <a href="{% url 'stark:dipay_inwardpay_list_detail' pk=row.payment.pk %}"
                                       target="_blank">{{ row.payment }}</a>
                                </td>
                            </tr>
                        {% endfor %}

                        </tbody>
                    </table>

                </div>
            </div>

            <form id='verify_release_form' action="" method="post" class="form-group">
                {% csrf_token %}
                <label for="verify-remark">审批意见</label>
                <textarea name="remark" id='verify-remark' cols="30" rows="1" class="form-control">-</textarea>
                <div class="form-control is-agree-div">
                    <div class="pull-left not-agree"><label for="not-agree">拒绝放单</label>
                        <input type="radio" id="not-agree" name="is_agree" value="False">
                    </div>

                    <div class="pull-left agree-release"><label for="agree">同意放单</label>
                        <input type="radio" name="is_agree" id='agree' value="True">
                    </div>

                </div>
                <button class="btn btn-warning" onclick="return sumbmitConfirmRelease()">提交</button>


            </form>


        </div>


    </div>



    <script src="{% static "rbac/permission_distribute.js" %}"></script>
    <script src="{% static "js/edit-follow-order.js" %}"></script>
    <script src="{% static "js/order-release-confirm.js" %}"></script>

    <script>

        function sumbmitConfirmRelease() {

            var href = location.href;
            var data_obj = new Object();
            // 手动获取form中的input name和val， 存入data_obj
            $('#verify_release_form [name]').each(function (i) {
                data_obj[$(this).attr('name')] = $(this).val()
            });
            $.ajax({
                url: href,
                type: 'post',
                data: data_obj,
                success: function (respond) {
                    console.log(respond)
                    if (respond.status) {
                        ShowTip(respond.msg, 'success');
                    } else {
                        ShowTip(respond.msg, 'warning')
                    }
                    setTimeout(`location.href="${respond.url}"`, 1500);
                    {#setTimeout("location.href=respond.url", 1000);#}
                }
            });


            return false;

        }


    </script>

{% endblock %}