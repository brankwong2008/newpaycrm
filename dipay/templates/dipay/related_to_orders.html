{% extends "layout.html" %}
{% load menu_list %}
{% load static %}
{% load filter-tool %}

{% block css %}
    <link rel="stylesheet" href="{% static '/css/dipay.css' %}">
    <style>

        tr.active {
            border-left: 3px solid orange;
        }

        .relate-btn {

            margin-right: 35px;
        }

        textarea[id^="amount"] {
            width: 87px;
            height: 36px;
        }

        .text-display, .date-display, .
        status-display, .invoice-amount-display {
            cursor: pointer;

        }

        .fa-check {
            color: green;
            font-size: 20px;
        }

        td.dist-amount, td.torelate-amount-display {
            font-weight: bolder;
            color: blue;
        }



    </style>

{% endblock %}


{% block content %}

    <div class="container-fluid">

        <div class="col-md-12">
            <!-- 收款记录 -->
            <div class="panel panel-info">
                {% csrf_token %}

                <div class="panel-heading"><i class="fa fa-get-pocket"></i>收款记录

                </div>

                <!-- Table -->
                <table class="table">
                    <thead>
                    <tr>
                        <th>付款日期</th>
                        <th>客户</th>
                        <th>付款人</th>
                        <th>水单金额</th>
                        <th>实收金额</th>
                        <th>收款银行</th>
                        <th>水单</th>
                        <th>待关联金额</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>{{ inwardpay_obj.create_date|date:"Y-m-d" }}</td>
                        <td>{{ inwardpay_obj.customer.shortname|default:'-'|truncatechars:15 }}</td>
                        <td>{{ inwardpay_obj.payer.title|default:'-'|truncatechars:15 }}</td>
                        <td>{{ inwardpay_obj.currency.icon }}{{ inwardpay_obj.amount }}</td>
                        <td>{{ inwardpay_obj.currency.icon }}{{ inwardpay_obj.got_amount }}</td>

                        <td>{{ inwardpay_obj.bank.title }}</td>
                        {% if inwardpay_obj.ttcopy %}
                            <td><img class='ttcopy-small-img' src="{{ inwardpay_obj.ttcopy.url }}"
                                     onclick="return popupImg(this)" width="30px" height="30px"></td>
                        {% else %}
                            <td><i class="fa fa-minus-square"></i></td>
                        {% endif %}

                        <td class="torelate-amount-display">
                            {{ inwardpay_obj.currency.icon }}{{ inwardpay_obj.torelate_amount }}</td>
                    </tr>
                    </tbody>
                </table>
            </div>


            <!-- 图片弹窗 -->
            <div id="ImgModal" class="newmodal">
                <!-- 关闭按钮 -->
                <span class="img-close" onclick="document.getElementById('ImgModal').style.display='none'">&times;</span>
                <!-- 弹窗内容 -->
                <img class="newmodal-content" id="img01">
                <!-- 文本描述 -->
                <div id="caption"></div>
            </div>

            <!-- 已关联记录 -->
            <div class="panel panel-success">
                <div class="panel-heading"><i class="fa fa-building"></i> 已关联记录</div>
                <div class="panel-body">
                    <!-- 已关联订单列表 -->
                    <table class="table">
                        <thead>
                        <tr>
                            <th>订单号</th>
                            <th>客户名</th>
                            <th>订单金额</th>
                            <th>已收金额</th>
                            <th>已关联金额</th>
                            <th>操作</th>

                        </tr>
                        </thead>
                        <tbody>

                        {% for row in related_order_list %}
                            <tr>
                                <td>{{ row.order.order_number }}</td>
                                <td>{{ row.order.customer.shortname }}</td>
                                <td>{{ row.order.currency.icon }}{{ row.order.amount }}</td>
                                <td>{{ row.order.currency.icon }}{{ row.order.rcvd_amount }}</td>
                                <td class="dist-amount">
                                     {{ row.order.currency.icon }} {{row.amount|multiply:row.rate}}
                                    {% if row.rate != 1 %}
                                        <span> (分配：{{ row.payment.currency.icon }}{{ row.amount }} x 汇率 {{ row.rate }}) </span>
                                    {% endif %}

                                </td>
                                <td>
                                    <a href="{% url 'stark:dipay_pay2orders_edit'  row.pk %}"><i class="fa fa-edit"></i></a>

                                </td>

                            </tr>
                        {% endfor %}

                        </tbody>
                    </table>

                </div>
            </div>


            <!-- 可关联订单列表 -->
            <div class="panel panel-default">
                <div class="panel-heading"><i class="fa fa-building"></i> 可关联订单列表 <span
                        class="pull-right btn-success">点击关联金额直接修改</span></div>
                <div class="panel-body">
                    <!-- 待关联订单列表 -->
                    <table class="table">
                        <thead>
                        <tr>
                            <th>订单号</th>
                            <th>客户名</th>
                            <th>订单金额</th>
                            <th>已收金额</th>
                            <th>应收账款</th>
                            <th>已关联金额</th>
                            <th>操作</th>

                        </tr>
                        </thead>
                        <tbody>

                        {% for row in torelate_order_list %}
                            <tr>
                                <td><a href="{{ row.followorder_url }}" target="_blank">{{ row.order_number }}</a></td>
                                <td>{{ row.customer.shortname }}</td>
                                <td>{{ row.currency.icon }}{{ row.amount }}</td>
                                <td><a href="{% url 'stark:dipay_followorder_show_pay_details' order_id=row.pk %}" is_fix_amount="{{ row.is_fix_amount }}"
                                       customer_name="{{ row.customer.shortname }}" onclick="return showPayDetails(this)">
                                    {{ row.currency.icon }}{{ row.rcvd_amount }}</a></td>
                                <td>{{ row.currency.icon }}{{ row.collect_amount }}</td>
                                <td class="dist-amount"> {{ row.dist_amount }} </td>
                                <td>
                                    {{ row.save_btn }}
                                    {{ row.del_btn }}
                                    {{ row.transfer_btn }}

                                </td>

                            </tr>
                        {% endfor %}

                        </tbody>
                    </table>

                </div>
            </div>

        </div>


    </div>



    <!-- Modal 模态对话框  显示收款明细 -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">收款明细</h4>
                </div>
                <div class="modal-body">
                    <div class="mymodal-details"></div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal 模态对话框  固定定金转移 -->
    <div class="modal fade" id="transferModal" tabindex="-1" role="dialog" aria-labelledby="transferModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="transferModalLabel">固定定金转出</h4>
                </div>
                <div class="modal-body">
                    <div class="transfer-details"></div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">提交</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>


    <script src="{% static "rbac/permission_distribute.js" %}"></script>
    <script src="{% static "js/edit-follow-order.js" %}"></script>


{% endblock %}